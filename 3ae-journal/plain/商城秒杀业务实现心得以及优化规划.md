# 商城秒杀业务实现心得以及优化规划

| 修订版本 | 修订内容  | 修订人员 | 文档类型 | 修订日期 |
| :-----: |  :-----:  | :-----: | :-----: | :-----: |
|  v1.0.1.* | 新建商城秒杀业务实现心得以及优化规划 | sid | -- | 2018-12-04 |
| ————— | —————————————————————————— | ————— | ————— | —————— |

版本号说明

* 版本号第四位: 修剪文档语句结构、内容布局，不计入修订版本。
* 版本号第三位: 二级模块内容、结构进行更新，计入修订版本。
* 版本号第二位: 一级模块内容、结构进行更新，计入修订版本。
* 版本号第一位: 不限于整个文档进行升级、包含的内容同时进行版本迭代，计入修订版本并生成新的文档。

修改文档名为：
1.快照版（同布更新）
2.稳定版（只维护，不更新）
3.最终版（不更新、不维护）

---

## 内容简介

* [1 业务功能](##业务功能)
* [1.1 流程简介](###流程简介)
* [1.2 注册登录](###注册登录)
* [1.3 商品查询](###商品查询)
* [1.4 商品下单](###商品下单)
* [1.5 订单支付](###订单支付)
* [1.6 订单查询](###订单查询)
* [1.7 订单评价](###订单评价)
* [2 数据设计](##数据设计)

## 业务功能

### 流程简介

### 注册登录

```mermaid
sequenceDiagram
用户 ->> 注册页面: 输入注册信息
注册页面 --x 用户: 注册信息格式不正确
注册页面 ->>注册服务: 传递注册信息
注册服务 ->> 注册页面: 返回服务器状态码
注册服务 --x 注册页面: 非法操作
注册服务 ->> 数据库集群: 存取用户数据
注册服务 --x 注册页面: 系统异常
注册服务 ->> 注册服务: 保存session
注册服务 ->> 用户: 返回用户的token并存入cookie
注册服务 ->> 用户: 注册成功，自动跳转商城首页
```

```mermaid
sequenceDiagram
用户 ->> 登录页面: 输入登录信息
登录页面 --x 用户: 用户名密码格式不正确
登录页面 ->>登录服务: 传递用户名密码
登录服务 ->> 登录页面: 返回服务器状态码
登录服务 --x 登录页面: 非法操作
登录服务 ->> 数据库集群: 存取用户数据
登录服务 --x 登录页面: 系统异常
登录服务 --x 用户: 用户名不存在，请注册
登录服务 --x 用户: 用户名密码错误，请重新输入
登录服务 ->> 登录服务: 保存session
登录服务 ->> 登录页面: 返回用户的token并存入cookie
登录服务 ->> 用户: 登录成功，自动跳转商城首页
```

### 商品查询

```mermaid
sequenceDiagram
用户 ->> 商品列表页: 根据分类grade查询商品列表
商品列表页 ->> 商品列表页: 查询时效内本地缓存中商品信息
商品服务 ->> 商品列表页: 返回服务器状态码
商品服务 --x 商品列表页: 非法操作
商品列表页 ->> 商品服务: 根据偏移量和范围查询商品信息
商品服务 ->> 数据库集群: 根据偏移量和范围查询商品信息
商品服务 --x 商品列表页: 系统异常
商品服务 --x 用户: 暂无可选商品
商品服务 ->> 商品列表页: 返回JSON对象数组
商品列表页 ->> 商品列表页: 存储时效商品信息到本地缓存
商品列表页 ->> 商品列表页: 根据时效刷新缓存
商品列表页 ->> 用户: AJAX异步生成商品列表
```

```mermaid
sequenceDiagram
用户 ->> 商品详情页: 根据商品ID查询商品详情
商品服务 ->> 商品详情页: 返回服务器状态码
商品服务 --x 商品详情页: 非法操作
商品详情页 ->> 商品服务: 根据ID查询商品详情
商品服务 ->> 数据库集群: 根据ID查询商品详情
商品服务 --x 商品详情页: 系统异常
商品服务 --x 用户: 暂无可选商品
商品服务 ->> 商品详情页: 返回JSON对象数组
商品详情页 ->> 用户: AJAX异步生成商品详情
```

### 商品下单

```mermaid
sequenceDiagram
用户 ->> 商品秒杀列表: 查看秒杀商品列表
商品秒杀列表 ->> 商品详情页: 秒杀商品
秒杀服务 ->> 商品秒杀列表: 获取服务器时间与秒杀时间
秒杀服务 ->> 商品详情页: 获取服务器时间与秒杀时间
秒杀服务 --x 用户: 秒杀还未开始
商品详情页 ->> 商品详情页: 刷新
秒杀服务 --x 用户: 秒杀已经结束
商品详情页 ->> 商品详情页: 刷新
商品详情页 ->> 秒杀服务: 根据商品ID查询加密秒杀信息
秒杀服务 ->> 商品详情页: 返回服务器状态码
秒杀服务 --x 用户: 不在秒杀时段
秒杀服务 --x 用户: 信息被篡改
秒杀服务 ->> 数据库集群: 根据ID查询商品
数据库集群 ->> 秒杀服务: 秒杀订单信息+1
秒杀服务 --x 商品详情页: 系统异常
秒杀服务 --x 用户: 商品已下架
秒杀服务 ->> 商品详情页: 返回秒杀商品详情信息
秒杀服务 ->> 用户: 选择商品规格参数，优惠券等信息。选择加入购物车，去支付……
秒杀服务 ->> 用户: 跳转购物车，若未登录存入本地缓存，登录后存入用户购物车
```

### 订单支付

```mermaid
sequenceDiagram
用户 ->> 个人中心: 查看购物车
个人中心 ->> 个人中心: 验证cookie信息，是否已登录
个人中心 --x 用户: 用户未登录……跳转登录页
个人中心 ->> 我的订单（购物车）: 查看订单信息：去支付、待收货、待评价、已完成、退货款
我的订单（购物车） ->> 订单服务: 填写收货信息、支付方式等内容完成订单
订单服务 ->> 我的订单（购物车）: 返回服务器状态码
订单服务 --x 用户: 订单超时关闭
订单服务 ->> 数据库集群: 根据商品ID添加订单信息
数据库集群 ->> 订单服务: 商品数量-1, 更新status
订单服务 --x 我的订单（购物车）: 系统异常
订单服务 ->> 用户: 商品秒杀已结束……正常价格
订单服务 --x 用户: 商品已下架
订单服务 ->> 用户: 已支付……待收货
```

### 订单查询

### 订单评价

### 仓储

### 积分

## 数据设计
