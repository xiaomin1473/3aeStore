<!DOCTYPE html>
<html lang="zh-CN">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

      <title>睿胜智能</title>
      <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
      <!-- <link rel="shortcut icon" href="./static/img/icon/logo.jpg" /> -->
      
      <link rel="stylesheet" href="./common/css/common.css">
      <link rel="stylesheet" href="./common/css/global.css">
      <link rel="stylesheet" href="./assets/css/login.css">
      
      <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
      <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

      <!--[if lt IE 9]>
            <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
            <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->

   </head>
   <body>
      <div class="container">
         <form class="login-form" id="form">
            <div class="login-form-wrapper">
               <div class="login-form-header">
                  <h2>费用申报流程管理系统</h2>
               </div>
               <div class="login-form-body">
                  <div class="login-form-items">
                     <label class="label" for="">用户名：</label><input class="input-default" type="text" placeholder="用户名"><i></i><br>
                     <span class="tips"></span>
                  </div>
                  <div class="login-form-items">
                     <label class="label" for="">密  码：</label><input class="input-default" type="password" placeholder="密码"><i></i><br>
                     <span class="tips" id="message"></span>
                  </div>
               </div>
               <div class="login-form-footer">
                  <button id="submit" type="button">登录</button>
                  <button class="btn-default" type="reset">重置</button>
               </div>
            </div>
         </form>
         <div class="copyright">
            Copyright © 2018-2028 南京睿胜智能科技有限公司 版权所有 保留一切权利
         </div>

         <div class="alert">
            <div class="alert-header">
               <h3>使用说明</h3>
            </div>
            <div class="alert-body">
               <h4>
                  报表用途：<br>用于公司的费用支出上报 登记 统计
               </h4>
               <h4>
                  适应业务范围：<br>适用于运营中心、营销中心、制造中心、研发中心
               </h4>
               <h4>
                  适应公司人员：<br> 各中心费用报销人员、财务部费用审核、各中心负责人
               </h4>
               <h4>
                  注意事项: <br>未经协商一致，不得更改表格格式（行 列 单元格）
               </h4>
            </div>
            <div class="alert-footer">
               <button id="closeAlert" type="submit">关闭</button>
            </div>
         </div>
      </div>
   </body>
</html>
<script src="./common/js/ae.js"></script>
<script>

   
   var submit = document.getElementById('submit');
   var callback;
   var closeAlert = document.getElementById('closeAlert');

   closeAlert.addEventListener("click", function(){ 
      var alert = document.getElementsByClassName('alert')[0];
      console.log(alert)
      alert.style.display = 'none';
   })

   
   submit.addEventListener("click", function(){
      var msg = document.getElementById('message');
      var input = document.getElementsByTagName('input');

      if(!input[0].value || !input[1].value) {
         msg.innerHTML = "用户名密码不能为空"
         return;
      }

      var userName = input[0].value;
      var userPwd = input[1].value;
      var form = document.getElementById('form');
      var context = `userName=${userName}&userPwd=${userPwd}` 

      Ae.trans.AJAX({
         type: "POST",
         url: "/user/login",
         async: true,
         context: context,
         contentType: "application/x-www-form-urlencoded"
      }, callback)

      function callback(xmls) {
         jsonName = xmls.responseText;
         jsonName = JSON.parse(jsonName);
         console.log(jsonName);
         if(jsonName.success) {
            
            window.location.href='/';

            var Days = 30;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days*24*60*60*1000);
            document.cookie = "Token" + "="+ escape (jsonName.data.token) + ";expires=" + exp.toGMTString();
            document.cookie = "UserName" + "="+ escape (jsonName.data.userName) + ";expires=" + exp.toGMTString();
            document.cookie = "UserPermit" + "="+ escape (jsonName.data.userPermit) + ";expires=" + exp.toGMTString();
         } else {
            msg.innerHTML = jsonName.error;
         }
      }
   });

   
   

</script>